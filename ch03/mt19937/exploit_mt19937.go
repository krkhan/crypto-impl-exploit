package mt19937

func untemper(y4 uint32) uint32 {
	y3 := y4 ^ (y4 >> L)

	y2 := y3 ^ (y3<<T)&C

	y2_0 := y2 << S
	y2_1 := y2 ^ (y2_0 & B)
	y2_2 := y2_1 << S
	y2_3 := y2 ^ (y2_2 & B)
	y2_4 := y2_3 << S
	y2_5 := y2 ^ (y2_4 & B)
	y2_6 := y2_5 << S
	y2_7 := y2 ^ (y2_6 & B)
	y2_8 := y2_7 << S
	y1 := y2 ^ (y2_8 & B)

	y1_0 := y1 >> U
	y1_1 := y1 ^ y1_0
	y1_2 := y1_1 >> U
	y := y1 ^ y1_2

	return y
}

func CloneMT19937(mt *MT19937) *MT19937 {
	cloned_mt := NewMT19937()

	for i := uint32(0); i < N; i++ {
		cloned_mt.state[i] = untemper(mt.Generate())
	}

	cloned_mt.index = mt.index
	cloned_mt.seeded = true

	return cloned_mt
}
