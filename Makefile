.PHONY: default

all: ch02 ch03 ch04 ch05

format:
	gofmt -s -w .

clean:
	go clean -testcache

################################################################################
# Chapter 2
################################################################################

impl_lcg: clean
	go test -v ./ch02/lcg/go/impl_lcg
exploit_lcg: clean
	go test -v ./ch02/lcg/go/exploit_lcg
lcg: impl_lcg exploit_lcg

ch02: lcg

################################################################################
# Chapter 3
################################################################################

impl_mt19937:
	go test -v ./ch03/mt19937/impl_mt19937
exploit_mt19937: clean
	go test -v ./ch03/mt19937/exploit_mt19937
mt19937: impl_mt19937 exploit_mt19937

impl_dual_ec_drbg: clean
	go test -v ./ch03/dual_ec_drbg/impl_dual_ec_drbg
exploit_dual_ec_drbg: clean
	go test -v ./ch03/dual_ec_drbg/exploit_dual_ec_drbg
dual_ec_drbg: impl_dual_ec_drbg exploit_dual_ec_drbg

ch03: mt19937 dual_ec_drbg

################################################################################
# Chapter 4
################################################################################

impl_lfsr: clean
	go test -v ./ch04/lfsr/impl_lfsr
exploit_lfsr: clean
	go test -v ./ch04/lfsr/exploit_lfsr
lfsr: impl_lfsr exploit_lfsr

impl_rc4: clean
	go test -v ./ch04/rc4/impl_rc4
exploit_rc4: clean
	go test -v ./ch04/rc4/exploit_rc4
rc4: impl_rc4 exploit_rc4
ch04: lfsr rc4

################################################################################
# Chapter 5
################################################################################

impl_padding_oracle: clean
	go test -v ./ch05/padding_oracle/impl_padding_oracle
exploit_padding_oracle: clean
	go test -v ./ch05/padding_oracle/exploit_padding_oracle
padding_oracle: impl_padding_oracle exploit_padding_oracle

impl_beast: clean
	go test -v ./ch05/beast/impl_beast
exploit_beast: clean
	go test -v ./ch05/beast/exploit_beast
beast: impl_beast exploit_beast
ch05: padding_oracle beast

